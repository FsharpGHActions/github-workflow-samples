# SPDX-FileCopyrightText: Copyright (C) 2025 Fabr√≠cio Barros Cabral
# SPDX-License-Identifier: MIT
---
name: action-security
'on':
  push:
    branches:
      - main
      - master
  pull_request:
    branches:
      - main
      - master
jobs:
  action-security:
    runs-on: ubuntu-24.04
    permissions:
      security-events: write
      contents: read
      actions: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      - name: Download and installs zizmor
        run: |
          curl -L https://github.com/zizmorcore/zizmor/releases/latest/download/zizmor-x86_64-unknown-linux-gnu.tar.gz \
            | tar xz
      - name: Check workflow files
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          ./zizmor .github/workflows --config .github/zizmor.yml
      - name: Stop pipeline if issues are found
        run: |
          if grep -q "error" zizmor.log; then
            echo "Security issues has been found by zizmor"
            cat zizmor.log
            exit 1
          fi
